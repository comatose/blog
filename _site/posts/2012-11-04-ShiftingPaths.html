<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Lambda Play - Shifting Paths</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <!-- <div id="logo"> -->
            <!--     <a href="/">Lambda Play</a> -->
            <!-- </div> -->
            <div id="navigation">
                <a href="../">Home</a>
                <!-- <a href="/about.html">About</a> -->
                <!-- <a href="/contact.html">Contact</a> -->
                <a href="../archive.html">Archive</a>
		<a href="../pages.html">Pages</a>
		<a href="../links.html">Links</a>
            </div>
        </div>

        <div id="content">
            <h1>Shifting Paths</h1>

            <div class="info">Posted on November  4, 2012</div>

<p><a href="http://code.google.com/codejam/contest/2075486/dashboard#s=p4">Problem Description</a></p>
<p>여전히 solveLarge는 미해결.</p>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span> <span class="kw">import</span>           Control.Parallel.Strategies
<span class="fu">&gt;</span> <span class="kw">import</span>           Data.Array
<span class="fu">&gt;</span> <span class="kw">import</span> <span class="kw">qualified</span> Data.BitSet                 <span class="kw">as</span> B</code></pre>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span> <span class="co">-- left and right paths</span>
<span class="fu">&gt;</span> <span class="kw">type</span> <span class="dt">Clearing</span> <span class="fu">=</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)
<span class="fu">&gt;</span> <span class="kw">type</span> <span class="dt">VisitState</span> <span class="fu">=</span> <span class="dt">B.BitSet</span> <span class="dt">Int</span>
<span class="fu">&gt;</span> <span class="kw">data</span> <span class="dt">Problem</span> <span class="fu">=</span> <span class="dt">Problem</span> {<span class="ot">destiny ::</span> <span class="dt">Int</span>,<span class="ot"> clearings ::</span> (<span class="dt">Array</span> <span class="dt">Int</span> <span class="dt">Clearing</span>)}
<span class="fu">&gt;</span>              <span class="kw">deriving</span> <span class="kw">Show</span></code></pre>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span> <span class="kw">data</span> <span class="dt">Scene</span> <span class="fu">=</span> <span class="dt">Scene</span> {<span class="ot">passed ::</span> <span class="fu">!</span><span class="dt">Integer</span>,<span class="ot"> clearing ::</span> <span class="dt">Int</span>,<span class="ot"> state ::</span> <span class="fu">!</span><span class="dt">VisitState</span>}
<span class="fu">&gt;</span> <span class="kw">instance</span> <span class="kw">Eq</span> <span class="dt">Scene</span> <span class="kw">where</span>
<span class="fu">&gt;</span>   (<span class="dt">Scene</span> _ c1 s1) <span class="fu">==</span> (<span class="dt">Scene</span> _ c2 s2) <span class="fu">=</span> c1 <span class="fu">==</span> c2 <span class="fu">&amp;&amp;</span> s1 <span class="fu">==</span> s2
<span class="fu">&gt;</span>   <span class="co">-- (==) = (==) `on` (clearing &amp;&amp;&amp; state)</span></code></pre>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span><span class="ot"> forward ::</span> <span class="dt">Problem</span> <span class="ot">-&gt;</span> <span class="dt">Scene</span> <span class="ot">-&gt;</span> <span class="dt">Scene</span>
<span class="fu">&gt;</span> forward (<span class="dt">Problem</span> dest clrs) (<span class="dt">Scene</span> c i m)
<span class="fu">&gt;</span>   <span class="fu">|</span> i <span class="fu">==</span> dest <span class="fu">=</span> <span class="dt">Scene</span> c i m
<span class="fu">&gt;</span>   <span class="fu">|</span> B.member i m <span class="fu">=</span> <span class="dt">Scene</span> (c <span class="fu">+</span> <span class="dv">1</span>) (<span class="fu">snd</span> path) (B.delete i m)   <span class="co">-- even case</span>
<span class="fu">&gt;</span>   <span class="fu">|</span> <span class="fu">otherwise</span> <span class="fu">=</span> <span class="dt">Scene</span> (c <span class="fu">+</span> <span class="dv">1</span>) (<span class="fu">fst</span> path) (B.insert i m)    <span class="co">-- odd case</span>
<span class="fu">&gt;</span>   <span class="kw">where</span> path <span class="fu">=</span> clrs <span class="fu">!</span> i</code></pre>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span> <span class="co">-- memory-intensive, only practical for small problems</span>
<span class="fu">&gt;</span><span class="ot"> solveSmall ::</span> <span class="dt">Problem</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
<span class="fu">&gt;</span> solveSmall p<span class="fu">@</span>(<span class="dt">Problem</span> dest _) <span class="fu">=</span> <span class="kw">if</span> <span class="fu">or</span> <span class="fu">$</span> <span class="fu">zipWith</span> (<span class="fu">==</span>) trail (ffw2x trail)
<span class="fu">&gt;</span>                                 <span class="kw">then</span> <span class="st">&quot;Infinity&quot;</span>
<span class="fu">&gt;</span>                                 <span class="kw">else</span> <span class="fu">show</span> <span class="fu">.</span> <span class="fu">length</span> <span class="fu">$</span> trail
<span class="fu">&gt;</span>   <span class="kw">where</span>
<span class="fu">&gt;</span>     <span class="co">-- series of scenes just before destination</span>
<span class="fu">&gt;</span>     trail <span class="fu">=</span> <span class="fu">takeWhile</span> ((<span class="fu">&lt;</span>dest)<span class="fu">.</span> clearing) <span class="fu">.</span> <span class="fu">iterate</span> (forward p) <span class="fu">$</span> (<span class="dt">Scene</span> <span class="dv">0</span> <span class="dv">1</span> B.empty)
<span class="fu">&gt;</span>     <span class="co">-- fast forward 2x</span>
<span class="fu">&gt;</span><span class="ot">     ffw2x ::</span> [a] <span class="ot">-&gt;</span> [a]
<span class="fu">&gt;</span>     ffw2x (_<span class="fu">:</span>x<span class="fu">:</span>xs) <span class="fu">=</span> x<span class="fu">:</span>ffw2x xs
<span class="fu">&gt;</span>     ffw2x _ <span class="fu">=</span> []</code></pre>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span> <span class="co">-- constant memory consumption, at the expense of computation</span>
<span class="fu">&gt;</span><span class="ot"> solveLarge ::</span> <span class="dt">Problem</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
<span class="fu">&gt;</span> solveLarge p<span class="fu">@</span>(<span class="dt">Problem</span> dest _) <span class="fu">=</span> go (<span class="dt">Scene</span> <span class="dv">0</span> <span class="dv">1</span> B.empty) (forward p (<span class="dt">Scene</span> <span class="dv">0</span> <span class="dv">1</span> B.empty))
<span class="fu">&gt;</span>   <span class="kw">where</span>
<span class="fu">&gt;</span><span class="ot">     go ::</span> <span class="dt">Scene</span> <span class="ot">-&gt;</span> <span class="dt">Scene</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
<span class="fu">&gt;</span>     go x1 x2
<span class="fu">&gt;</span>       <span class="fu">|</span> clearing x2 <span class="fu">==</span> dest <span class="fu">=</span> <span class="fu">show</span> <span class="fu">.</span> passed <span class="fu">$</span> x2
<span class="fu">&gt;</span>       <span class="fu">|</span> x1 <span class="fu">==</span> x2 <span class="fu">=</span> <span class="st">&quot;Infinity&quot;</span>
<span class="fu">&gt;</span>       <span class="fu">|</span> <span class="fu">otherwise</span> <span class="fu">=</span> go (forward p x1) (forward p <span class="fu">.</span> forward p <span class="fu">$</span> x2)</code></pre>
<pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="fu">&gt;</span><span class="ot"> main ::</span> <span class="dt">IO</span> ()
<span class="fu">&gt;</span> main <span class="fu">=</span> <span class="fu">interact</span> <span class="fu">$</span>
<span class="fu">&gt;</span>        <span class="fu">unlines</span> <span class="fu">.</span> withStrategy (parList rdeepseq) <span class="fu">.</span> numbering
<span class="fu">&gt;</span>        <span class="fu">.</span> <span class="fu">map</span> solveLarge <span class="fu">.</span> problemify <span class="fu">.</span> <span class="fu">tail</span> <span class="fu">.</span> <span class="fu">lines</span>
<span class="fu">&gt;</span>     <span class="kw">where</span>
<span class="fu">&gt;</span><span class="ot">       numbering ::</span> [<span class="dt">String</span>] <span class="ot">-&gt;</span> [<span class="dt">String</span>]
<span class="fu">&gt;</span>       numbering <span class="fu">=</span> <span class="fu">zipWith</span> (<span class="fu">++</span>) [<span class="st">&quot;Case #&quot;</span> <span class="fu">++</span> <span class="fu">show</span> n <span class="fu">++</span> <span class="st">&quot;: &quot;</span> <span class="fu">|</span> n <span class="ot">&lt;-</span> ([<span class="dv">1</span><span class="fu">..</span>]<span class="ot"> ::</span> [<span class="dt">Int</span>])]
<span class="fu">&gt;</span> 
<span class="fu">&gt;</span>       <span class="co">-- build a clearing from one line</span>
<span class="fu">&gt;</span><span class="ot">       parseClearing ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Clearing</span>
<span class="fu">&gt;</span>       parseClearing xs <span class="fu">=</span> <span class="kw">let</span> [l, r] <span class="fu">=</span> <span class="fu">map</span> <span class="fu">read</span> <span class="fu">$</span> <span class="fu">words</span> xs <span class="kw">in</span> (l, r)
<span class="fu">&gt;</span> 
<span class="fu">&gt;</span><span class="ot">       problemify ::</span> [<span class="dt">String</span>] <span class="ot">-&gt;</span> [<span class="dt">Problem</span>]
<span class="fu">&gt;</span>       problemify [] <span class="fu">=</span> []
<span class="fu">&gt;</span>       problemify (x<span class="fu">:</span>xs) <span class="fu">=</span>
<span class="fu">&gt;</span>         <span class="dt">Problem</span> n (listArray (<span class="dv">1</span>, n <span class="fu">-</span> <span class="dv">1</span>) (<span class="fu">map</span> parseClearing clrs)) <span class="fu">:</span> problemify rest
<span class="fu">&gt;</span>         <span class="kw">where</span> n <span class="fu">=</span> <span class="fu">read</span> x
<span class="fu">&gt;</span>               (clrs, rest) <span class="fu">=</span> <span class="fu">splitAt</span> (n <span class="fu">-</span> <span class="dv">1</span>) xs</code></pre>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'lambdaplay'; // required: replace example with your forum shortname
  var disqus_identifier = '/posts/2012-11-04-ShiftingPaths.html';
  var disqus_title = 'Shifting Paths';
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
    </body>
</html>
